<!DOCTYPE html>
<html lang="en">
<%- include("partials/head.ejs", {title: 'Pokedex' }) %>
<script>
    let dist = 0;
    let ticking = false;
    let pokemon = <%- JSON.stringify(pokemon) %>;

    const preprocessMonImgs = () => {
        let index = 1;
        for (pokemon of pokemon) {
            let curMonImg = $('<img>');
            curMonImg.attr('src', pokemon.img);
            curMonImg.addClass('pokemon');
            let pokeNum = $('<div>');
            pokeNum.addClass('poke-num')
            pokeNum.text(pokemon.id);
            let monDiv = $('<a>');
            monDiv.attr('href','/'+index)
            monDiv.addClass('pokemon-card');
            monDiv.append(curMonImg);
            monDiv.append(pokeNum);
            $('.poke-display').append(monDiv);
            index++;
        }
    }

    const updatePokemonDisplay = () => {
        if (dist > 0) dist = 0;
        $('.poke-display').css('left', dist);
    }

    $(window).on('mousewheel', event => {
        if (!ticking) {
            window.requestAnimationFrame(function() {
                dist = dist + (event.originalEvent.wheelDeltaY / 8);
                updatePokemonDisplay();
                ticking = false;
            });
        }
        ticking = true;
    })

    $(document).ready( () => {
        preprocessMonImgs();

        $(".poke-search").submit(function(event) {
            event.preventDefault();
            let num = $(this).find(':last').val()
            $(this).find(':last').val('')
            if (isNaN(num) || Number(num) < 1 || Number(num) > 151) return;
            dist = 100 - (214 * (num-1));
            updatePokemonDisplay();
        });
    })
</script>

<body>
    <body class="main box">
        <%- include("partials/navbar.ejs") %>
    
        <div class="view box">
            <div class="poke-display">
                <%= pokemon.name %> 
            </div>
        </div>
    </div>
</body>
</html>